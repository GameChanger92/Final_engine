name: CI
on:
  push:        { branches: ["*"] }
  pull_request: { branches: ["*"] }

jobs:
  test:
    runs-on: ubuntu-latest

    # ğŸŒ± (ì¡ ì „ì²´ env â†’ ë‘ ë³€ìˆ˜ ì œê±°)
    env:
      # ì‹¤ì œ í‚¤ê°€ í•„ìš”í•˜ë©´ ì£¼ì„ í•´ì œ
      # GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
      # OPENAI_API_KEY:  ${{ secrets.OPENAI_API_KEY }}

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with: { python-version: "3.11" }

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install black ruff pytest

      - name: Ruff Lint
        run: ruff check .

      - name: Black Check
        run: black --check .

      - name: Run pytest
        run: pytest -q          # â† ì´ì œ ì›ë˜ ê¸°ëŒ€ê°’ìœ¼ë¡œ í†µê³¼

      # ğŸ”§  íŒŒì´í”„ë¼ì¸ë§Œ ë”ë¯¸ ëª¨ë“œë¡œ
      - name: Test pipeline script
        env:
          UNIT_TEST_MODE: "1"
          FAST_MODE: "1"
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
          OPENAI_API_KEY:  ${{ secrets.OPENAI_API_KEY }}
        run: python scripts/run_pipeline.py --project-id default --episodes 2
