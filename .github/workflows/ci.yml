name: CI

on:
  push:
    branches: ["*"]          # ëª¨ë“  ë¸Œëœì¹˜ì—ì„œ í‘¸ì‹œ ì‹œ ë™ì‘
  pull_request:
    branches: ["*"]          # ëª¨ë“  ë¸Œëœì¹˜ PRì—ì„œ ë™ì‘

jobs:
  test:
    runs-on: ubuntu-latest
    env:                     # ğŸ‘ˆ ëª¨ë“  ìŠ¤í… ê³µí†µ í™˜ê²½ë³€ìˆ˜
      UNIT_TEST_MODE: "1"
      FAST_MODE: "1"

    steps:
      # 1) ì†ŒìŠ¤ ì²´í¬ì•„ì›ƒ
      - uses: actions/checkout@v4

      # 2) íŒŒì´ì¬ ì„¤ì¹˜
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # 3) ì˜ì¡´ì„± + í¬ë§¤í„°/ë¦°í„° ì„¤ì¹˜
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install black ruff pytest

      # 4) í’ˆì§ˆ ê²€ì‚¬ (Ruff â†’ Black)
      - name: Ruff Lint
        run: ruff check .

      - name: Black Check
        run: black --check .

      # 5) ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
      - name: Run pytest
        run: pytest -q

      # 6) ìŠ¤ëª¨í¬ íŒŒì´í”„ë¼ì¸
      #    - LLM í˜¸ì¶œì€ ê±´ë„ˆë›°ê³ (UNIT_TEST_MODE)
      #    - ëŒ€ëŸ‰ ì„ë² ë”©ë„ ìƒëµ(FAST_MODE)
      - name: Test pipeline script
        run: python scripts/run_pipeline.py --project-id default --episodes 2
